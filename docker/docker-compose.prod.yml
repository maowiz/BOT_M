version: '3.8'

services:
  anythingllm:
    image: mintplexlabs/anythingllm
    container_name: anythingllm
    ports:
      - "3001:3001"
    cap_add:
      - SYS_ADMIN
    environment:
      - STORAGE_DIR=/app/server/storage
      - JWT_SECRET="change-this-secret-key-123"
      - LLM_PROVIDER=ollama
      - OLLAMA_BASE_PATH=http://host.docker.internal:11434 
      - VECTOR_DB=lancedb
      - WHISPER_PROVIDER=local
      - TTS_PROVIDER=native
      # Point to our internal crawl service
      # NOTE: In production, use the service name if on same network, or internal IP
      # Here assuming they are on same bridge network 'anything-llm-net'
    volumes:
      - anythingllm_storage:/app/server/storage
      - ./.env:/app/server/.env
    restart: always
    networks:
      - anything-llm-net

  crawl-service:
    build: 
      context: ../
      dockerfile: Dockerfile.crawl_service
    container_name: crawl-service
    ports:
      - "11235:11235"
    restart: always
    networks:
      - anything-llm-net

volumes:
  anythingllm_storage:
    driver: local

networks:
  anything-llm-net:
    driver: bridge
